---
- group: name="mirrorbits" state=present
- user: state=present
        name="mirrorbits"
        groups="mirrorbits"
        shell="/bin/false"

- file: path=/srv/mirrorbits state=directory
        mode=0755 owner=root group=root

- file: path=/srv/mirrorbits/logs state=directory
        mode=0755 owner=mirrorbits group=root

- template: src=mirrorbits.conf
            dest=/etc/mirrorbits.conf
            mode=0640 owner=mirrorbits group=root

- copy: dest=/usr/lib/tmpfiles.d/mirrorbits.conf
      content="d /run/mirrorbits 0755 mirrorbits mirrorbits -"
      mode=0640 owner=root group=root

- name: deploy mirrorbits systemd units
  copy:
      dest: /etc/systemd/system/
      src: "mirrorbits.service"
      mode: 0644
  register: mirrorbits_unit

- name: reload daemons
  systemd:
        daemon-reload: yes
  when: mirrorbits_unit.changed

- systemd: state=started enabled=yes name=mirrorbits.service
- systemd: state=started enabled=yes name=redis.service
